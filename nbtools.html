<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>查看私密纸条</title>
</head>
<body>
  <div>
    <input type="text" id="keyInput" placeholder="请输入4位提取密钥">
    <button onclick="getMemoContent()">确认查看</button>
    <div id="contentArea" style="margin-top: 20px; white-space: pre-wrap;"></div>
  </div>

  <script>
    // 从URL参数中自动填充key（可选，提升体验）
    window.onload = function() {
      const urlParams = new URLSearchParams(window.location.search);
      const key = urlParams.get('key');
      if (key) {
        document.getElementById('keyInput').value = key;
        getMemoContent(); // 自动查询
      }
    };

    // 核心：调用代理函数获取纸条内容
    async function getMemoContent() {
      const key = document.getElementById('keyInput').value.trim();
      const contentArea = document.getElementById('contentArea');
      
      // 1. 输入校验
      if (!key || key.length !== 4 || isNaN(key)) {
        contentArea.innerText = "请输入有效的4位数字提取密钥！";
        return;
      }

      // 2. 显示加载状态
      contentArea.innerText = "正在查询...";

      try {
        // 3. 调用Netlify代理函数（替换为你的Netlify域名，或用相对路径）
        const response = await fetch(`/.netlify/functions/memo-proxy?key=${key}`);
        const result = await response.json(); // 解析JSON（不再报错）

        // 4. 渲染结果
        if (result.success) {
          contentArea.innerText = result.content; // 显示纸条内容
        } else {
          contentArea.innerText = `错误：${result.message}`; // 显示错误信息
        }
      } catch (error) {
        // 网络/解析异常处理
        contentArea.innerText = `网络请求失败：${error.message}`;
      }
    }
  </script>
</body>
</html>
